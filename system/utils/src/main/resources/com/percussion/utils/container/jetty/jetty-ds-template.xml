<?xml version="1.0"?>
<!--
  ~     Percussion CMS
  ~     Copyright (C) 1999-2020 Percussion Software, Inc.
  ~
  ~     This program is free software: you can redistribute it and/or modify
  ~     it under the terms of the GNU Affero General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.
  ~
  ~     This program is distributed in the hope that it will be useful,
  ~     but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  ~     GNU Affero General Public License for more details.
  ~
  ~     Mailing Address:
  ~
  ~      Percussion Software, Inc.
  ~      PO Box 767
  ~      Burlington, MA 01803, USA
  ~      +01-781-438-9900
  ~      support@percussion.com
  ~      https://www.percussion.com
  ~
  ~     You should have received a copy of the GNU Affero General Public License along with this program.  If not, see <https://www.gnu.org/licenses/>
  -->

<!DOCTYPE Configure PUBLIC "-//Jetty//Configure//EN" "http://www.eclipse.org/jetty/configure_9_3.dtd">
<Configure id="Server" class="org.eclipse.jetty.server.Server">
<New id="perc.ds.{0}" class="org.eclipse.jetty.plus.jndi.Resource">
   <Arg></Arg>
   <Arg>java:{1}</Arg>
   <Arg>
     <New class="com.zaxxer.hikari.HikariDataSource">
       <Arg>
          <New class="com.zaxxer.hikari.HikariConfig">
             <Set name="poolName">Hikari <Property name="perc.ds.{0}.name"/> Pool</Set>
             <Set name="connectionTimeout">120000</Set>
             <Set name="minimumIdle"><Property name="perc.ds.{0}.connections.min" default="50"/></Set>
             <Set name="maximumPoolSize"><Property name="perc.ds.{0}.connections.max" default="50"/></Set>
             <Set name="idleTimeout"><Property name="perc.ds.{0}.idle.ms" default="600000"/></Set>
             <Set name="transactionIsolation">TRANSACTION_READ_COMMITTED</Set>
             <Set name="ConnectionTestQuery">
             <Call class="com.percussion.utils.container.PSStaticContainerUtils" name="connectionTestQuery">
                        <Arg><Property name="perc.ds.{0}.driver.name"/></Arg>
                        <Arg><Property name="perc.ds.{0}.connectiontest"/></Arg>
             </Call>
             </Set>
             <Set name="driverClassName"><Property name="perc.ds.{0}.driver.class"/></Set>
             <Set name="jdbcUrl">jdbc:<Property name="perc.ds.{0}.driver.name"/>:<Property name="perc.ds.{0}.server"/></Set>
             <Set name="username" ><Property name="perc.ds.{0}.uid"/></Set>
             <Set name="password" >
              <Call class="com.percussion.utils.container.PSStaticContainerUtils" name="decrypt">
                <Arg><Property name="perc.ds.{0}.pwd"/></Arg>
                <Arg><Property name="perc.ds.{0}.pwd.encrypted"/></Arg>
              </Call>
            </Set>
          </New>
       </Arg>
    </New>
  </Arg>
</New>
</Configure>

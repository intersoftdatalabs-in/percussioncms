<?xml version="1.0"?>

<project name="rxDoCopyJars" default="copy">
   <description>
      Deploys Rhythmyx jars from the specified directory into a 6.x installation dir.

        Usage:
          ant -DJARS='Rhythmyx jars' -DRXROOT='Rhythmyx installation dir' [-DOVERWRITE=true] -f rxDoCopyJars.xml
   </description>

   <property name="web.inf.lib" value="WEB-INF/lib"/>
   <property name="web.inf.classes" value="WEB-INF/classes"/>
   <property name="OVERWRITE" value="false"/>

   <target name="init">
      <property name="administration" location="${RXROOT}/Administration"/>
      <!-- Root of the rx application server -->
      <property name="server.root" location="${RXROOT}/AppServer/server/rx"/>
      <property name="server.lib" location="${server.root}/lib"/>
      <property name="rxapp.lib"
            location="${server.root}/deploy/rxapp.ear/rxapp.war/${web.inf.lib}"/>
      <property name="rxapp.classes"
            location="${server.root}/deploy/rxapp.ear/rxapp.war/${web.inf.classes}"/>
      <property name="applet.jars" location="${RXROOT}/sys_resources/AppletJars"/>

      <property name="cm.lib" location="${server.root}/deploy/cm.war/${web.inf.lib}"/>

   	  <property name="eclipsePlugins" location="${RXROOT}/eclipse/plugins"/>
      <property name="client.eclipsePlugin" location="${eclipsePlugins}/com.percussion.client_1.0.0/lib"/>
      <property name="workbench.eclipsePlugin" location="${eclipsePlugins}/com.percussion.workbench_1.0.0/lib"/>

      <fail message="Property 'JARS' must be set to point to the directory with Rhythmyx libraries to copy from.">
         <condition>
            <or>
               <not>
                  <isset property="JARS"/>
               </not>
               <not>
                  <available file="${JARS}/rxserver.jar"/>
               </not>
               <not>
                  <available file="${JARS}/rxclient.jar"/>
               </not>
            </or>
         </condition>
      </fail>

      <fail message="Proprety 'RXROOT' must be set to point to a Rhythmyx install.">
         <condition>
            <or>
               <not>
                  <isset property="RXROOT"/>
               </not>
               <not>
                  <available file="${rxapp.lib}/rxserver.jar"/>
               </not>
               <not>
                  <available file="${administration}/rxclient.jar"/>
               </not>
            </or>
         </condition>
      </fail>
   </target>

   <target name="copy" depends="init">
      <copy todir="${administration}" overwrite="${OVERWRITE}">
         <fileset dir="${JARS}">
            <include name="help.jar"/>
            <include name="percbeans.jar"/>
            <include name="rhythmyx.jar"/>
            <include name="rxclient.jar"/>
            <include name="rxmisctools.jar"/>
            <include name="rxservices.jar"/>
            <include name="rxtablefactory.jar"/>
            <include name="rxutils.jar"/>
            <include name="serveruicomp.jar"/>
         </fileset>
      </copy>

      <copy todir="${server.lib}" overwrite="${OVERWRITE}">
         <fileset dir="${JARS}">
            <include name="rxlogin.jar"/>
            <include name="rxutils.jar"/>
         </fileset>
      </copy>

      <mkdir dir="${RXROOT}/lib"/>
      <copy todir="${RXROOT}/lib" overwrite="${OVERWRITE}">
         <fileset dir="${JARS}">
            <include name="rxloader.jar"/>
            <include name="rxlogin.jar"/>
            <include name="rxutils.jar"/>
			<include name="pspackagerui.jar"/>
         </fileset>
      </copy>

      <copy todir="${rxapp.lib}">
         <fileset dir="${JARS}">
            <include name="deploy.jar"/>
            <include name="deployui.jar"/>
            <include name="rxdeployer.jar"/>
            <include name="help.jar"/>
            <include name="htmlConverter.jar"/>
            <include name="percbeans.jar"/>
            <include name="psjniregistry.jar"/>
            <include name="rhythmyx.jar"/>
            <include name="rxagent.jar"/>
         	<include name="rxbusiness.jar"/>
         	<include name="rxDesignObjectUtils.jar"/>
            <include name="rxclient.jar"/>
            <include name="rxcontentui.jar"/>
            <include name="rxextensions.jar"/>
            <include name="rxff.jar"/>
            <include name="rxlogin.jar"/>
            <include name="rxi18n.jar"/>
            <include name="rxinstall.jar"/>
            <include name="rxmisctools.jar"/>
            <include name="rxportal.jar"/>
            <include name="rxpublisher.jar"/>
            <include name="rxserver.jar"/>
            <include name="rxservices.jar"/>
            <include name="rxservlet.jar"/>
            <include name="rxsimple.jar"/>
            <include name="rxtablefactory.jar"/>
            <include name="rxuploader.jar"/>
            <include name="rxutils.jar"/>
            <include name="rxwebservices.jar"/>
            <include name="rxworkflow.jar"/>
            <include name="serveruicomp.jar"/>
            <include name="servertest.jar"/>
            <include name="sharetest.jar"/>
            <include name="rxtesting.jar"/>
         	<include name="image-widget-1.0.jar"/>
         </fileset>
      </copy>

      <copy todir="${cm.lib}">
           <fileset dir="${JARS}">
              <include name="psgadgetsupport.jar"/>
              <include name="pssso.jar"/>
              <include name="pstmxtags.jar"/>
           </fileset>
      </copy>
   	
      <copy todir="${applet.jars}" overwrite="${OVERWRITE}">
         <fileset dir="${JARS}">
            <include name="help.jar"/>
            <include name="rxCheckboxTree.jar"/>
            <include name="rxcx.jar"/>
         </fileset>
      </copy>

      <!-- in case dev tools are not installed -->
      <mkdir dir="${client.eclipsePlugin}"/>
      <mkdir dir="${workbench.eclipsePlugin}"/>
      <copy todir="${client.eclipsePlugin}">
         <fileset dir="${JARS}">
            <include name="rxclient.jar"/>
            <include name="rxdesignercore.jar"/>
            <include name="rxi18n.jar"/>
            <include name="rxmisctools.jar"/>
            <include name="rxservices.jar"/>
            <include name="rxtablefactory.jar"/>
            <include name="rxutils.jar"/>
            <include name="rxwebservices.jar"/>
         </fileset>
      </copy>

      <copy todir="${workbench.eclipsePlugin}">
         <fileset dir="${JARS}">
            <include name="help.jar"/>
            <include name="htmlConverter.jar"/>
            <include name="percbeans.jar"/>
            <include name="rxservices.jar"/>
            <include name="rxutils.jar"/>
            <include name="rxworkbench.jar"/>
            <include name="serveruicomp.jar"/>
         	<include name="rxDesignObjectUtils.jar"/>
         </fileset>
      </copy>
   	
   	<!-- the following XML files are already in servertest.jar, but JBoss may not
   			pick up the latest changes. So we already copy the test/data files into
   			the classes directory to force any changes to take effect. 
   	-->
      <copy todir="${rxapp.classes}"  overwrite="${OVERWRITE}">
         <fileset dir="${basedir}/../deployer/server/src">
            <include name="com/percussion/rx/config/**/*.xml"/>
         </fileset>
      </copy>
   	
   </target>

</project>

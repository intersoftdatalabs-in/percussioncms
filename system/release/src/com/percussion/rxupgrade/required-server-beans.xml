<!--
  ~     Percussion CMS
  ~     Copyright (C) 1999-2020 Percussion Software, Inc.
  ~
  ~     This program is free software: you can redistribute it and/or modify
  ~     it under the terms of the GNU Affero General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.
  ~
  ~     This program is distributed in the hope that it will be useful,
  ~     but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  ~     GNU Affero General Public License for more details.
  ~
  ~     Mailing Address:
  ~
  ~      Percussion Software, Inc.
  ~      PO Box 767
  ~      Burlington, MA 01803, USA
  ~      +01-781-438-9900
  ~      support@percussion.com
  ~      https://www.percussion.com
  ~
  ~     You should have received a copy of the GNU Affero General Public License along with this program.  If not, see <https://www.gnu.org/licenses/>
  -->

<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xmlns:tx="http://www.springframework.org/schema/tx">
   <bean id="sys_notificationService"
		class="com.percussion.services.notification.impl.PSNotificationService">
	</bean>
	
   <bean id="sys_systemService"
      class="com.percussion.services.system.impl.PSSystemService">
      <property name="sessionFactory">
         <ref bean="sys_sessionFactory" />
      </property>
		<property name="emailTemplate">
			<ref bean="sys_jmsQueueTemplate"/>
		</property>   
		<property name="emailDestination">
			<ref bean="sys_emailQueueDestination"/>
		</property>  
   </bean>	
	
	<bean id="sys_jmsQueueTemplate" class="org.springframework.jms.core.JmsTemplate">
		<property name="connectionFactory">
			<ref bean="sys_jmsConnectionFactory"/>
		</property>
		<property name="defaultDestination">
			<ref bean="sys_notificationQueueDestination"/>
		</property>
	</bean>
	
	<bean id="sys_jmsTopicTemplate" class="org.springframework.jms.core.JmsTemplate">
		<property name="connectionFactory">
			<ref bean="sys_jmsConnectionFactory"/>
		</property>
		<property name="defaultDestination">
			<ref bean="sys_notificationTopicDestination"/>
		</property>
	</bean>	
	      
	<bean id="sys_jmsConnectionFactory"
		class="org.springframework.jndi.JndiObjectFactoryBean">
		<property name="jndiName">
			<value>ConnectionFactory</value>
		</property>
	</bean>
	
	<bean id="sys_notificationQueueDestination" 
		class="org.springframework.jndi.JndiObjectFactoryBean">
		<property name="jndiName">
			<value>queue/notificationQueue</value>
		</property>		
	</bean>
	
	<bean id="sys_notificationTopicDestination" 
		class="org.springframework.jndi.JndiObjectFactoryBean">
		<property name="jndiName">
			<value>topic/notificationTopic</value>
		</property>		
	</bean>
	
	<bean id="sys_emailQueueDestination" 
		class="org.springframework.jndi.JndiObjectFactoryBean">
		<property name="jndiName">
			<value>queue/emailQueue</value>
		</property>		
	</bean>
	
	<bean id="sys_emailQueueListener" 
		class="com.percussion.services.system.impl.PSEmailMessageHandler">
	</bean>
		
	<bean id="sys_emailMessageHandlerContainerQ"
		  class="org.springframework.jms.listener.DefaultMessageListenerContainer">
		  <property name="concurrentConsumers" value="3"/>
		  <property name="connectionFactory" ref="sys_jmsConnectionFactory" />
		  <property name="destination" ref="sys_emailQueueDestination" />
		  <property name="messageListener" ref="sys_emailQueueListener" />
	</bean>	
	
	<bean id="sys_beanConfiguration"
		class="com.percussion.services.utils.general.PSServiceConfigurationBean">
      <!-- This can improve assembly performance by caching
      	content items. Please remember that the overall memory
      	impact will be this maximum times the number of items allowed
      	in the content region of the memory cache. -->
		<property name="maxCachedContentNodeSize" value="100000"/>
	</bean>
   
   <!-- Test service used only for AOP based web service security testing -->
   <bean id="sys_securityAopTestWebService" 
      class="com.percussion.webservices.aop.security.impl.PSSecurityAopTestImplWs" />     
   <bean id="sys_securityAopTestWebServiceDesign" 
      class="com.percussion.webservices.aop.security.impl.PSSecurityAopTestImplDesignWs" />     
</beans>      

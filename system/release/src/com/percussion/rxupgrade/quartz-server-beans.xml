<!--
  ~     Percussion CMS
  ~     Copyright (C) 1999-2020 Percussion Software, Inc.
  ~
  ~     This program is free software: you can redistribute it and/or modify
  ~     it under the terms of the GNU Affero General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.
  ~
  ~     This program is distributed in the hope that it will be useful,
  ~     but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  ~     GNU Affero General Public License for more details.
  ~
  ~     Mailing Address:
  ~
  ~      Percussion Software, Inc.
  ~      PO Box 767
  ~      Burlington, MA 01803, USA
  ~      +01-781-438-9900
  ~      support@percussion.com
  ~      https://www.percussion.com
  ~
  ~     You should have received a copy of the GNU Affero General Public License along with this program.  If not, see <https://www.gnu.org/licenses/>
  -->

<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xmlns:tx="http://www.springframework.org/schema/tx">
   <bean id="sys_quartzScheduler"
         class="com.percussion.services.schedule.impl.PSSchedulerBean"
         destroy-method="destroy">
      <!-- Configurable scheduler factory properties
           org.quartz.threadPool.threadCount property is defined in sys_beanConfiguration
      -->
      <property name="quartzProperties">
         <value>
            org.quartz.scheduler.instanceName=DefaultQuartzScheduler
            org.quartz.scheduler.rmi.export=false
            org.quartz.scheduler.rmi.proxy=false
            org.quartz.scheduler.wrapJobExecutionInUserTransaction=false
            org.quartz.threadPool.class=org.quartz.simpl.SimpleThreadPool
            org.quartz.threadPool.threadPriority=5
            org.quartz.threadPool.threadsInheritContextClassLoaderOfInitializingThread=true
            org.quartz.jobStore.misfireThreshold=60000
            org.quartz.jobStore.class=org.quartz.impl.jdbcjobstore.JobStoreTX
            org.quartz.jobStore.tablePrefix=PSX_Q
            org.quartz.jobStore.dataSource=rhythmyxDataSource
         org.quartz.dataSource.rhythmyxDataSource.connectionProvider.class=com.percussion.services.schedule.impl.PSRhythmyxConnectionProvider
         </value>
      </property>
      <property name="datasourceManager">
         <ref bean="sys_datasourceManager"/>
      </property>
      <property name="configurationBean">
      	<ref bean="sys_beanConfiguration" />
      </property>    
   </bean>

	<bean id="sys_schedulingService"
      class="com.percussion.services.schedule.impl.PSSchedulingService">
      <property name="sessionFactory">
         <ref bean="sys_sessionFactory"/>
      </property>
      <property name="scheduler">
         <ref local="sys_quartzScheduler"/>
      </property>
   </bean>
</beans>

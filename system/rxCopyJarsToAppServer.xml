<?xml version="1.0"?>
<project name="rxCopyJarsToAppServer" default="copyAll" basedir=".">
  
   <property name="output.dir" location="${basedir}/build" />   
   <property name="OVERWRITE" value="false"/>
   <property name="overwrite.web.xml" value="false" />
      
   <target name="init">
      <fail unless="RXROOT" message="RXROOT must be set to point to a Rx install."/>
      <!-- Set properties -->
      <property name="rx.app.root" location="${RXROOT}/AppServer/server/rx"/>
      <property name="rx.app.root.deploy" location="${rx.app.root}/deploy"/>
      <property name="rx.app.war.dir" location="${rx.app.root.deploy}/rxapp.ear/rxapp.war"/>
   </target>
   
   <target name="copyAll" depends="init" description="Main target">
      <antcall target="copyJars"/>
      <antcall target="copyAppFiles"/>
   </target>
   
   <target name="copyJars" depends="init" description="Main target">
   	<!-- copy jars -->
      <ant antfile="rxDoCopyJars.xml" dir="." inheritAll="false">
   		<property name="JARS" value="${output.dir}/lib"/>
      	<propertyset>
      		<propertyref name="RXROOT"/>
      		<propertyref name="OVERWRITE"/>
      	</propertyset>
   	</ant>

      <copy todir="${rx.app.war.dir}/WEB-INF" overwrite="${overwrite.web.xml}">
         <fileset dir="${basedir}/ear/WEB-INF"/>
         <filterset begintoken="@@" endtoken="@@">
            <filter token="rxDir" value="${RXROOT}"/>
         </filterset>
      </copy>

      <copy todir="${rx.app.war.dir}/WEB-INF/classes">
         <fileset dir="${basedir}/ear/config/hibernate"/>
      </copy>

   	  <mkdir dir="${rx.app.war.dir}/WEB-INF/config/spring/projects" />
   	
      <copy todir="${rx.app.war.dir}/WEB-INF/config/spring">
         <fileset dir="${basedir}/ear/config/spring">
            <include name="beans.xml"/>
            <include name="cataloger-beans.xml"/>
			<include name="deployer-beans.xml"/>
            <include name="design-beans.xml"/>
         	<include name="workbench-beans.xml"/>
         </fileset>
      	<fileset dir="${basedir}/ear/config/spring">
      		<include name="projects/*.xml"/>
      	</fileset>
      </copy>

      <copy todir="${rx.app.war.dir}/WEB-INF/config/user/spring">
         <fileset dir="${basedir}/ear/config/user/spring">
            <include name="user-beans.xml"/>
         </fileset>
      </copy>

      <copy todir="${rx.app.war.dir}/WEB-INF/config/velocity">
         <fileset dir="${basedir}/ear/config/velocity"/>
      </copy>
   </target>  
    
   <target name="copyAppFiles" depends="init">
      <copy todir="${RXROOT}/sys_resources">
         <fileset dir="${basedir}/cms/content/applications/sys_resources/ApplicationFiles"/>
      </copy>
      <copy todir="${RXROOT}/rx_resources">
         <fileset dir="${basedir}/cms/content/applications/rx_resources/ApplicationFiles"/>
      </copy>
      <copy todir="${rx.app.war.dir}">
      	<fileset dir="${basedir}/ear/jsps"/>
      </copy>
      <copyfile src="${basedir}/cms/content/applications/sys_resources/ApplicationFiles/i18n/SystemResources.tmx" 
      	dest="${RXROOT}/rxconfig/I18n/ResourceBundle.tmx"/>      
      <copyfile src="${basedir}/release/installer/config/rxW2Ktidy.properties" 
        dest="${RXROOT}/rxW2Ktidy.properties"/>      
   </target>
</project>
